services:
  postgres-db:
    container_name: postgres
    image: "postgres:15"
    environment:
      - "POSTGRES_DB=shopping_list"
      - "POSTGRES_PASSWORD=password"
    volumes:
      - db-data:/var/lib/postgresql/data
    restart: unless-stopped
  pgadmin:
    container_name: pgadmin4
    image: dpage/pgadmin4
    environment:
      - "PGADMIN_DEFAULT_EMAIL=postgres@example.com"
      - "PGADMIN_DEFAULT_PASSWORD=password"
      - "PGADMIN_LISTEN_PORT=5050"
    volumes:
      - ./servers.json:/pgadmin4/servers.json
      - pgadmin-data:/var/lib/pgadmin
    restart: on-failure
  backend:
    container_name: backend
    build: backend
    volumes:
      - ./backend:/code
    depends_on:
      - postgres-db
      - redis-server
    restart: unless-stopped
  webserver:
    container_name: webserver
    image: "nginx"
    depends_on:
      - backend
      - pgadmin
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./default.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 80:80
    restart: unless-stopped
  redis-server:
    container_name: redis_server
    image: redis
    ports:
      - 6379:6379
    restart: on-failure
volumes:
  db-data:
  pgadmin-data:

